var e,t,a=(e,t,a)=>{if(!t.has(e))throw TypeError("Cannot "+a)},s=(e,t,s)=>(a(e,t,"read from private field"),s?s.call(e):t.get(e)),n=(e,t,a)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,a)},r=(e,t,s,n)=>(a(e,t,"write to private field"),n?n.call(e,s):t.set(e,s),s);import{a as o}from"../axios/axios.a44b2fc3.js";import{g as i,r as c}from"../../assets/index-61b17357.js";import{o as d,j as h}from"../element-plus/element-plus.86321995.js";const l=e=>[e.method,e.url,e.params,e.data].join("&");class p{constructor(){n(this,e,void 0),r(this,e,new Map)}addPending(t){this.removePending(t);const a=l(t),n=new AbortController;t.signal=t.signal||n.signal,s(this,e).has(a)||s(this,e).set(a,n)}removeAllPending(){s(this,e).forEach((e=>{e&&e.abort()})),this.reset()}removePending(t){const a=l(t);if(s(this,e).has(a)){const t=s(this,e).get(a);t&&t.abort(a),s(this,e).delete(a)}}reset(){s(this,e).clear()}}let m;e=new WeakMap;const g=()=>{m&&m.close()},u=e=>{h.error(e)},w={baseURL:"http://101.35.45.46:13209/",timeout:1e4,withCredentials:!0};class f{constructor(e){n(this,t,void 0);const a=Object.assign(w,e);r(this,t,o.create(a));const l=new p;s(this,t).interceptors.request.use((t=>{i()&&(t.headers={Authorization:`${i()}`||""});const a={...w,...e,...t};var s;return a.cache&&("get"===a.method?a.params={...a.params,_t:Date.parse(`${new Date}`)/1e3}:"post"===a.method&&(a.data={...a.data,_t:Date.parse(`${new Date}`)/1e3})),a.isLoading&&(s=a.loadingText||"加载中....",m=d.service({lock:!0,text:s,background:"rgba(0, 0, 0, 0.7)"})),(null==e?void 0:e.isCancel)&&l.addPending(a),a}),(e=>{Promise.reject(e)})),s(this,t).interceptors.response.use((async e=>{g(),e&&l.removePending(e.config);const{data:t}=e;return 200!==t.code?(432===t.code?(u("登录已过期或令牌无效"),c(),setTimeout((()=>{window.location.href="/"}),1e3)):u(t.msg||"请求失败"),Promise.reject(t)):(e.config.isShowSuccessText&&h.success(t.msg),t)}),(e=>{const{response:t}=e;t&&l.removePending(t.config),o.isCancel(e)||(g(),window.navigator.onLine?u("请求失败"):u("网络连接失败"))}))}async get(e){return(await s(this,t).get(e.url,e)).data}async post(e){return(await s(this,t).post(e.url,e.data,e)).data}async put(e){return(await s(this,t).put(e.url,e)).data}async delete(e){return(await s(this,t).delete(e.url,e)).data}}t=new WeakMap;const v=new f({headers:{"Content-Type":"application/json"},cache:!0,isLoading:!0});new f({headers:{"Content-Type":"multipart/form-data"},cache:!0,isCancel:!0,isLoading:!0});export{v as h};
